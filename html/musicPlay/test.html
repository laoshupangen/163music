<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>测试</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style media="screen">
        body {
            height: 100vh;
            background: url('../../image/bg1.jpg') no-repeat top;
            background-size: cover;
        }

        .beginPlay {
            padding: 5px 10px;
            background-color: #9c9c64;
        }
    </style>
</head>

<body>
    <br>
    <div class="beginPlay" onclick="playMusic()">
        开始播放
    </div><br>
    <div class="beginPlay" onclick="stopPlay()">
        暂停播放
    </div><br>
    <div class="beginPlay" onclick="getNowPlayTime()">
        查看当前播放时间
    </div>

    <script src="../../script/api.js" charset="utf-8"></script>
    <script type="text/javascript">
        apiready = function() {
            var audioStreamer = api.require('audioStreamer');
            audioStreamer.openPlayer({
                path: 'http://7xisq1.com1.z0.glb.clouddn.com/apicloud/0d0b81b8bd5ab81bda9ca54267eb9b98.mp3',
            }, function(ret) {
                if (ret.status) {
                    console.log(JSON.stringify(ret));

                    addSlider(ret.duration);
                }
            });
            // addSlider();
            var timer = setInterval(function () {
              getNowPlayTime();
            }, 336*1000/300);
        }

        function getNowPlayTime() {
          var audioStreamer = api.require("audioStreamer");
          audioStreamer.getCurrentTime(function(ret) {
            console.log(JSON.stringify(ret));
          });

        }
        function playMusic() {
          var audioStreamer = api.require("audioStreamer");
          audioStreamer.openPlayer();
        }
        function stopPlay() {
          var audioStreamer = api.require("audioStreamer");
          audioStreamer.pause();
          getNowPlayTime();
        }

        function addSlider(duration) {
            var uislider = api.require("UISlider");
            uislider.open({
                animation: false,
                orientation: 'horizontal',
                rect: {
                    x: 40,
                    y: 300,
                    size: 300
                },
                bubble: {
                    direction: 'top',
                    state: 'hide',
                    w: 0,
                    h: 0,
                    size: 0,
                    color: '#888',
                    bg: 'widget://res/slider/bubble.png',
                    prefix: '',
                    suffix: ''
                },
                handler: {
                    w: 14,
                    h: 14,
                    bg: 'widget://res/slider/button_1.png'
                },
                bar: {
                    h: 6,
                    bg: '#ccc',
                    active: '#d42323'
                },
                value: {
                    min: 0,
                    max: duration,
                    step: duration/300,
                    init: duration/2
                },
                fixedOn: api.frameName,
                fixed: false
            }, function(ret, err) {
                if (ret) {
                    console.log(JSON.stringify(ret));
                    if (ret.eventType == 'end') {
                        var audioStreamer = api.require("audioStreamer");
                        audioStreamer.stop();
                        // audioStreamer.seekToTime({
                        //     time: ret.value
                        // });

                    }
                } else {
                    console.log(JSON.stringify(err));
                }
            });


        }
    </script>

</body>

</html>
